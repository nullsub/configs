\chapter{Netfilter und Iptables}
\section{Grundkonfiguration}
Die Regeln werden in /etc/iptables.test.rules geschrieben:
\lstinputlisting[style=Bash,basicstyle=\small,breaklines=true]{../current_etc/iptables.test.rules}
\begin{lstlisting}[style=Bash]
$ iptables-save > iptables.ip.rules
\end{lstlisting}
Script in /etc/network/if-pre-up.d/iptables ausführbar machen.\\
\begin{lstlisting}[style=Bash]
$ iptables-restore<iptables.ip.rules
\end{lstlisting}
fail2ban installieren:
\begin{lstlisting}[style=Bash]
# apt-get install fail2ban
\end{lstlisting}
Bei 3 mal wiederholtem einloggen mit falschen Zugangsdaten wird die IP für 10 Minuten gesperrt.
\section{Forwarding und Masquerading}
Um das forwarding zu aktivieren muss dies in sysctl.conf aktiviert werden:
\begin{lstlisting}[style=Bash]
/etc/sysctl.conf:
net.ipv4.ip_forward = 1
\end{lstlisting}
\begin{lstlisting}[style=Bash]
sysctl -p /etc/sysctl.conf
\end{lstlisting}
\section{Diagnose und Logging}
Zur Diagnose werden alle blockierten Pakete geloggt.\\
Dropped Pakete können im syslog eingesehen werden:
\begin{lstlisting}[style=Bash]
# cat /var/log/messages | grep iptables
\end{lstlisting}
