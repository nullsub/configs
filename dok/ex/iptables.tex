\chapter{Netfilter und Iptables}
\section{Grundkonfiguration}
Um im Netzwerk ein- und ausgehende Pakete kontrollieren zu können 
und sich vor unerwünschten Netzwerkzugriffen zu schützen, wurde die 
Userspace Implementierung iptables benutzt, die auf die Firewall im Linux-Kernel zurückgreift.
Um den ausgehenden Internetzugriff der Nodes zu realisieren,
müssen NAT-regeln implementiert und forwarding im Linux-Kernel aktiviert werden.\\
Die Regeln werden in /etc/iptables.test.rules geschrieben:
\lstinputlisting[style=Bash,basicstyle=\small,breaklines=true]{../current_etc/iptables.test.rules}
\begin{lstlisting}[style=Bash]
$ iptables-save > iptables.ip.rules
\end{lstlisting}
Script in /etc/network/if-pre-up.d/iptables ausführbar machen.\\
\begin{lstlisting}[style=Bash]
$ iptables-restore<iptables.ip.rules
\end{lstlisting}
fail2ban installieren:
\begin{lstlisting}[style=Bash]
# apt-get install fail2ban
\end{lstlisting}
Bei 3 mal wiederholtem einloggen mit falschen Zugangsdaten wird die IP für 10 Minuten gesperrt.
\section{Forwarding und Masquerading}
Forwarding wird in sysctl.conf aktiviert:
\begin{lstlisting}[style=Bash]
/etc/sysctl.conf:
net.ipv4.ip_forward = 1
\end{lstlisting}
\begin{lstlisting}[style=Bash]
sysctl -p /etc/sysctl.conf
\end{lstlisting}
\section{Diagnose und Logging}
Zur Diagnose werden alle blockierten Pakete geloggt.\\
Dropped Pakete können im syslog eingesehen werden:
\begin{lstlisting}[style=Bash]
# cat /var/log/messages | grep iptables
\end{lstlisting}
